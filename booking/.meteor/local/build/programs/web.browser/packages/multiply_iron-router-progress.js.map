{"version":3,"sources":["meteor://ðŸ’»app/packages/multiply_iron-router-progress/template.progress.js","meteor://ðŸ’»app/packages/multiply_iron-router-progress/progress.coffee"],"names":[],"mappings":"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","file":"/packages/multiply_iron-router-progress.js","sourcesContent":["\nTemplate.__checkName(\"__IronRouterProgress__\");\nTemplate[\"__IronRouterProgress__\"] = new Template(\"Template.__IronRouterProgress__\", (function() {\n  var view = this;\n  return Blaze._TemplateWith(function() {\n    return {\n      template: Spacebars.call(view.lookup(\"template\")),\n      data: Spacebars.call(view.lookup(\"data\"))\n    };\n  }, function() {\n    return Spacebars.include(function() {\n      return Spacebars.call(Template.__dynamic);\n    });\n  });\n}));\n\nTemplate.__checkName(\"__IronRouterProgressDefault__\");\nTemplate[\"__IronRouterProgressDefault__\"] = new Template(\"Template.__IronRouterProgressDefault__\", (function() {\n  var view = this;\n  return HTML.DIV({\n    id: \"iron-router-progress\",\n    \"class\": function() {\n      return Spacebars.mustache(view.lookup(\"cssClass\"));\n    },\n    style: function() {\n      return Spacebars.mustache(view.lookup(\"cssStyle\"));\n    }\n  });\n}));\n","# Default progress options\nRouter.configure\n\tprogress        : true\n\tprogressDebug   : false\n\tprogressDelay   : false\n\tprogressSpinner : true\n\tprogressTick    : true\n\n# Used to debug the package, if progressDebug is true\ndebug = -> console.log.apply console, arguments if Router.current().lookupOption 'progressDebug'\n\nTemplate.__IronRouterProgress__.created = ->\n\tself = @\n\n\t@ticker  = false\n\t@delay   = false\n\t@started = false\n\t@loading = new ReactiveVar false\n\t@spinner = new ReactiveVar false\n\t@done    = new ReactiveVar false\n\t@percent = new ReactiveVar false\n\n\t@functions =\n\t\treset : (element) ->\n\t\t\tdebug 'Reset'\n\n\t\t\tself.functions.stop()\n\n\t\t\t# Reset our variables\n\t\t\tself.loading.set false\n\t\t\tself.done.set    false\n\t\t\tself.percent.set 0\n\t\t\tself.started =   false\n\n\t\t\telement.offsetWidth = element.offsetWidth if element\n\n\t\t\tself\n\n\t\tstart : (element) ->\n\t\t\tdebug 'Start'\n\n\t\t\t# Reset our progress\n\t\t\tself.functions.reset element\n\n\t\t\t# Update the spinner status, if it changed\n\t\t\tself.spinner.set Router.current().lookupOption('progressSpinner') or false\n\n\t\t\tself.loading.set true\n\n\t\t\t# If we have a delay, wait with the progress\n\t\t\tdelay = Router.current().lookupOption 'progressDelay'\n\t\t\tif delay > 0\n\t\t\t\tdebug 'Delayed'\n\t\t\t\tself.delay = Meteor.setTimeout ->\n\t\t\t\t\tself.started = true\n\t\t\t\t\tself.functions.progress()\n\t\t\t\t\tself.functions.tick()\n\t\t\t\t, delay\n\t\t\telse\n\t\t\t\tdebug 'Not delayed'\n\t\t\t\tself.started = true\n\t\t\t\tself.functions.progress()\n\t\t\t\tself.functions.tick()\n\n\t\t\tself\n\n\t\tprogress : (progress = false) ->\n\t\t\tdebug 'Progress'\n\n\t\t\t# XX We need a better random number generation here\n\t\t\tpercent    = self.percent.get()\n\t\t\tpercentNew = percent + if progress then progress else (100 - percent) * (Math.random() * 0.45 + 0.05) | 0\n\n\t\t\tif percentNew >= 100\n\t\t\t\tself.functions.done()\n\t\t\telse\n\t\t\t\tself.percent.set percentNew\n\t\t\t\tself.functions.tick()\n\n\t\t\tself\n\n\t\ttick : ->\n\t\t\tdebug 'Tick'\n\n\t\t\tif Router.current().lookupOption 'progressTick'\n\t\t\t\tdebug 'starting new ticker'\n\t\t\t\tif self.ticker\n\t\t\t\t\tMeteor.clearTimeout self.ticker\n\t\t\t\t\tself.ticker = false\n\n\t\t\t\tself.ticker = Meteor.setTimeout ->\n\t\t\t\t\tself.ticker = false\n\t\t\t\t\tself.functions.progress()\n\t\t\t\t, Math.random() * 750 + 750\n\t\t\telse\n\t\t\t\tdebug 'Not starting ticker'\n\n\t\t\tself\n\n\t\tdone : ->\n\t\t\tdebug 'Done'\n\n\t\t\tself.functions.stop()\n\n\t\t\tif not self.started\n\t\t\t\tself.functions.reset()\n\t\t\telse\n\t\t\t\t_.defer ->\n\t\t\t\t\tself.done.set true\n\t\t\t\tself.loading.set true\n\t\t\t\tself.percent.set 100\n\t\t\tself\n\n\t\tstop : ->\n\t\t\tdebug 'Stop'\n\n\t\t\t# Clear the timers, if we have any\n\t\t\tif self.ticker\n\t\t\t\tMeteor.clearTimeout self.ticker\n\t\t\t\tself.ticker = false\n\t\t\tif self.delay\n\t\t\t\tMeteor.clearTimeout self.delay\n\t\t\t\tself.delay = false\n\n\t\t\tself\n\n\tRouter.load ->\n\t\tdebug 'IR:load'\n\t\telement = self.find '*'\n\t\tself.functions.start element\n\n\t\t@next()\n\t\t@\n\n\tRouter.unload ->\n\t\tdebug 'IR:unload'\n\t\tself.functions.reset()\n\t\t@\n\n\tRouter.onRun ->\n\t\tdebug 'IR:run'\n\t\tself.loading.set true\n\t\t@next()\n\t\t@\n\n\tRouter.onRerun ->\n\t\tdebug 'IR:re-run'\n\t\t@next()\n\t\t@\n\n\tRouter.onBeforeAction ->\n\t\tdebug 'IR:before'\n\t\tif @ready()\n\t\t\tself.functions.done()\n\t\t\tself.functions.stop()\n\t\telse\n\t\t\tself.functions.progress()\n\t\t@next()\n\t\t@\n\n\tRouter.onAfterAction ->\n\t\tdebug 'IR:after'\n\t\t@\n\n\tRouter.onStop ->\n\t\tdebug 'IR:stop'\n\t\tself.functions.reset()\n\t\t@\n\nTemplate.__IronRouterProgress__.helpers\n\tdata     : -> Template.instance()\n\ttemplate : ->\n\t\t# If progress is disabled in general, don't show a template\n\t\treturn null if not Router.current()?.lookupOption 'progress'\n\n\t\tif Template.instance().loading.get() then '__IronRouterProgressDefault__' else null\n\nTemplate.__IronRouterProgressDefault__.rendered = ->\n\t# Used for the CSS reset\n\t@element = @$ '#iron-router-progress'\n\nTemplate.__IronRouterProgressDefault__.helpers\n\tcssClass : ->\n\t\tclasses = []\n\n\t\tclasses.push 'loading' if @loading.get()\n\t\tclasses.push 'spinner' if @spinner.get()\n\t\tclasses.push 'done'    if @done.get()\n\n\t\tclasses.join ' '\n\tcssStyle : ->\n\t\tstyles = []\n\t\t\n\t\tstyles.push \"width:#{@percent.get()}%\" if @percent.get()\n\n\t\tstyles.join ';'\n\nTemplate.__IronRouterProgressDefault__.events\n\t'transitionend #iron-router-progress, webkitTransitionEnd #iron-router-progress, oTransitionEnd #iron-router-progress, otransitionend #iron-router-progress, MSTransitionEnd #iron-router-progress' : (e, template) ->\n\t\t# Only reset, if this is the last transition, and that it's not a psuedo selector, such as `:before` and `:after`\n\t\t# Due to the open nature, of the CSS, I want people to be able to do whatever they like, and as such\n\t\t# simply expecting opacity to reach zero, or specific propertyName to execute won't suffice\n\t\t# A more elegant solution should be added, as not all browsers may support transition-property\n\t\t# witout their vendor prefixes\n\n\t\tif e.originalEvent.pseudoElement is '' and e.originalEvent.propertyName is _.last template.element.css('transition-property').split ', '\n\t\t\tdebug 'transitionend'\n\t\t\tdata = Template.currentData()\n\t\t\tdata.done.set    false\n\t\t\tdata.loading.set false\n\t\t\tdata.percent.set false\n\n# Prepare our DOM-element\nMeteor.startup ->\n\tlayout = new Iron.Layout\n\t\ttemplate : '__IronRouterProgress__'\n\tlayout.insert\n\t\tel : document.body\n"]}